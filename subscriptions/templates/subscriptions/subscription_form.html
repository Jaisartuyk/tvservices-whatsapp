{% extends 'subscriptions/base_form.html' %}

{% load crispy_forms_tags %}

{% block form_title %}
    {% if form.instance.pk %}
        <i class="bi bi-pencil-square"></i> Editar Suscripción
    {% else %}
        <i class="bi bi-plus-circle"></i> Nueva Suscripción
    {% endif %}
    <small class="text-muted d-block mt-1">
        Cliente: {{ client.nombre_completo }}
    </small>
{% endblock %}

{% block cancel_url %}
    {% if form.instance.pk %}
        {% url 'client_detail' client.pk %}
    {% else %}
        {% url 'client_detail' client.pk %}
    {% endif %}
{% endblock %}

{% block submit_text %}
    {% if form.instance.pk %}Actualizar{% else %}Crear{% endif %} Suscripción
{% endblock %}

{% block extra_css %}
<style>
    /* Estilos personalizados para el formulario de suscripción */
    .card {
        border-radius: 10px;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #e3e6f0;
    }
    .btn-primary {
        background-color: #4e73df;
        border-color: #4e73df;
    }
    .btn-primary:hover {
        background-color: #2e59d9;
        border-color: #2653d4;
    }
    .form-control:focus, .form-select:focus {
        border-color: #bac8f3;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    .service-option {
        border: 1px solid #e3e6f0;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s;
    }
    .service-option:hover {
        background-color: #f8f9fa;
        border-color: #bac8f3;
    }
    .service-option.selected {
        background-color: #f0f4ff;
        border-color: #4e73df;
    }
    .service-option input[type="radio"] {
        display: none;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Actualizar el precio cuando se selecciona un servicio
        const serviceSelect = document.getElementById('id_service');
        const priceInput = document.getElementById('id_price_paid');
        
        if (serviceSelect && priceInput) {
            // Establecer el precio inicial si hay un servicio seleccionado
            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            if (selectedOption && selectedOption.value) {
                const price = selectedOption.getAttribute('data-price');
                if (price) {
                    priceInput.value = price;
                }
            }
            
            // Actualizar el precio cuando cambia la selección
            serviceSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const price = selectedOption.getAttribute('data-price');
                if (price) {
                    priceInput.value = price;
                }
            });
        }
        
        // Manejar la selección visual de servicios
        const serviceOptions = document.querySelectorAll('.service-option');
        serviceOptions.forEach(option => {
            option.addEventListener('click', function() {
                // Remover la clase 'selected' de todas las opciones
                serviceOptions.forEach(opt => opt.classList.remove('selected'));
                // Agregar la clase 'selected' a la opción clickeada
                this.classList.add('selected');
                // Establecer el valor seleccionado en el select
                const radio = this.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    // Disparar el evento change manualmente
                    const event = new Event('change');
                    serviceSelect.dispatchEvent(event);
                }
            });
        });
        
        // Establecer la opción seleccionada inicialmente
        const selectedRadio = document.querySelector('.service-option input[type="radio"]:checked');
        if (selectedRadio) {
            selectedRadio.closest('.service-option').classList.add('selected');
        }
    });
</script>
{% endblock %}
